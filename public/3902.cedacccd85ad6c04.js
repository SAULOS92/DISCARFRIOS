"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3902],{3902:(C,p,d)=>{d.r(p),d.d(p,{RuteroOrdenDiaPageModule:()=>Z});var h=d(4755),O=d(5030),o=d(942),m=d(7957),g=d(5861),e=d(2223),D=d(1409);function I(r,c){1&r&&(e.TgZ(0,"label")(1,"h5",3),e._uU(2,"Sin Resultados"),e.qZA()())}function y(r,c){1&r&&e._UZ(0,"img",12)}function R(r,c){if(1&r&&(e.TgZ(0,"ion-item",13),e._UZ(1,"ion-reorder",4),e.TgZ(2,"ion-card",13)(3,"ion-card-content")(4,"strong")(5,"h5",14),e._uU(6),e.qZA()()()()()),2&r){const t=c.$implicit;e.xp6(6),e.HOy("",t.Cliente," - ",t.RZ," - ",t.Direccion," - ",t.Barrio,"")}}const S=[{path:"",component:(()=>{class r{constructor(t,i,n,a){this.ruteroService=t,this.route=i,this.loadingController=n,this.router=a,this.sinresult=!1,this.lastCallTimestamp=0,this.cacheDuration=864e5}ngOnInit(){const t=this.route.snapshot.paramMap.get("dia"),i=localStorage.getItem("number"),n=localStorage.getItem("ruteroCacheOrden"),a=localStorage.getItem("ruteroCacheOrdenTimestamp");if(n&&a){const s=parseInt(a);if((new Date).getTime()-s<this.cacheDuration)return this.items=JSON.parse(n),this.filterItemsByDay(t),this.filterItemsByUpdate(),void(this.sinresult=0===this.items.length)}this.presentLoading(),null!==i&&(this.ruteroSubscription=this.ruteroService.getRutero(parseInt(i)).subscribe(s=>{this.items=s,this.filterItemsByDay(t),this.filterItemsByUpdate(),this.sinresult=0===this.items.length,localStorage.setItem("ruteroCacheOrden",JSON.stringify(s)),localStorage.setItem("ruteroCacheOrdenTimestamp",(new Date).getTime().toString()),this.dismissLoading()}))}presentLoading(){var t=this;return(0,g.Z)(function*(){yield(yield t.loadingController.create({message:"Cargando...",translucent:!0,spinner:"crescent"})).present()})()}dismissLoading(){var t=this;return(0,g.Z)(function*(){yield t.loadingController.dismiss()})()}filterItemsByDay(t){this.items=this.items.filter(i=>i.Dias===t).sort((i,n)=>parseInt(i.OrdenDia)-parseInt(n.OrdenDia))}filterItemsByUpdate(){this.items=this.items.filter(t=>!t.update)}reorderItems(t){const i=this.items[t.detail.from];this.items.splice(t.detail.from,1),this.items.splice(t.detail.to,0,i),t.detail.complete(),this.items.forEach((s,l)=>{s.OrdenDia=l+1});const n=localStorage.getItem("ruteroCacheOrden"),a=JSON.parse(n||"[]");this.items.forEach(s=>{const l=a.findIndex(u=>u.id===s.id);-1!==l&&(a[l].OrdenDia=s.OrdenDia)}),localStorage.setItem("ruteroCacheOrden",JSON.stringify(a))}saveChanges(){var t=this;return(0,g.Z)(function*(){yield t.presentLoading();const i=[];try{let n=3;yield t.items.forEach(function(){var l=(0,g.Z)(function*(u,f){const v={...u,OrdenDia:n,update:"si"};n+=3,i.push(v)});return function(u,f){return l.apply(this,arguments)}}());const a=localStorage.getItem("ruteroCacheOrden"),s=JSON.parse(a||"[]");t.items.forEach(l=>{const u=s.findIndex(f=>f.id===l.id);-1!==u&&(s[u].OrdenDia=l.OrdenDia,s[u].update="si")}),localStorage.setItem("ruteroCacheOrden",JSON.stringify(s)),t.ruteroService.update(i),console.log("Datos actualizados en Firebase")}catch(n){console.error("Error al actualizar datos en Firebase",n)}finally{t.router.navigate(["/rutero"]),yield t.dismissLoading()}})()}ngOnDestroy(){this.ruteroSubscription&&this.ruteroSubscription.unsubscribe()}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(D.a),e.Y36(m.gz),e.Y36(o.HT),e.Y36(m.F0))},r.\u0275cmp=e.Xpm({type:r,selectors:[["SO-rutero-orden-dia"]],decls:16,vars:5,consts:[["color","primary"],["slot","start"],["defaultHref","rutero"],["text-center",""],["slot","end"],[3,"click"],[3,"scrollY"],[1,"ion-content-scroll-host"],[4,"ngIf"],["src","./assets/shapes.svg",4,"ngIf"],[3,"disabled","ionItemReorder"],["style","width: 100%",4,"ngFor","ngForOf"],["src","./assets/shapes.svg"],[2,"width","100%"],[2,"font-size","smaller"]],template:function(t,i){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),e._UZ(3,"ion-back-button",2),e.qZA(),e.TgZ(4,"ion-title",3),e._uU(5," Orden Rutero "),e.qZA(),e.TgZ(6,"ion-buttons",4)(7,"ion-button",5),e.NdJ("click",function(){return i.saveChanges()}),e._uU(8,"Guardar Cambios"),e.qZA()()()(),e.TgZ(9,"ion-content",6)(10,"div",7),e.YNc(11,I,3,0,"label",8),e.YNc(12,y,1,0,"img",9),e.TgZ(13,"ion-list")(14,"ion-reorder-group",10),e.NdJ("ionItemReorder",function(a){return i.reorderItems(a)}),e.YNc(15,R,7,4,"ion-item",11),e.qZA()()()()),2&t&&(e.xp6(9),e.Q6J("scrollY",!1),e.xp6(2),e.Q6J("ngIf",i.sinresult),e.xp6(1),e.Q6J("ngIf",i.sinresult),e.xp6(2),e.Q6J("disabled",!1),e.xp6(1),e.Q6J("ngForOf",i.items))},dependencies:[h.sg,h.O5,o.oU,o.YG,o.Sm,o.PM,o.FN,o.W2,o.Gu,o.Ie,o.q_,o.Nh,o.oz,o.wd,o.sr,o.cs],styles:[".ion-content-scroll-host[_ngcontent-%COMP%]{position:absolute;top:0;left:0;height:100%;width:100%;overflow-y:auto}"]}),r})()}];let T=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[m.Bz.forChild(S),m.Bz]}),r})(),Z=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[h.ez,O.u5,o.Pc,T]}),r})()}}]);